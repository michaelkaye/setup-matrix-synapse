name: "units-test"
on:
  pull_request:
  push:
    branches:
      - main
      - 'releases/*'

jobs:

  # test action works running from the graph
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-python@v2
      with:
        python-version: "3.x"
    - name: Run synapse
      uses: ./
      with: 
        uploadLogs: true
        httpPort: 8008
  
  test-modules:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-python@v2
      with:
        python-version: "3.x"
    - name: Run synapse
      uses: ./
      with: 
        uploadLogs: true
        httpPort: 8008
        customModules: [ "git+https://github.com/michaelkaye/noop-synapse-storage-provider.git#egg=noop-synapse-storage-provider" ]
        customConfig: 
          media_storage_providers:
            - module: noop_storage_provider
              store_local: True
              store_remote: True
              store_synchronous: True
              config:
                sample: "sample"
